"use strict";exports.__esModule=true;var chartist_1=require("chartist");var theme_1=require("../../common/theme");require("./pieChart.scss");var vis={id:"colossal-pie-chart",label:"Pie Chart (Colossal)",options:{sumLabel:{type:"string",label:"Sum Label","default":"All transactions"},currency:{type:"string",label:"Currency","default":"â‚¬"}},create:function(){},formatCurrencyValue:function(value,currency){return""+currency+Math.round(value).toLocaleString();},getSummary:function(){var summaryEl=document.createElement("div");summaryEl.classList.add("summary");summaryEl.append(this.sumLabel+": "+this.formatCurrencyValue(this.data.map(function(el){return el.value;}).reduce(function(a,b){return a+b;}),this.currency));return summaryEl;},getLegendItem:function(dataItem,i){var itemLI=document.createElement("li");var labelDiv=document.createElement("div");labelDiv.classList.add("label");var indicatorDiv=document.createElement("div");indicatorDiv.classList.add("indicator");indicatorDiv.style.background=theme_1.colors[i];labelDiv.appendChild(indicatorDiv);labelDiv.append(dataItem.label);itemLI.appendChild(labelDiv);var valueEl=document.createElement("div");valueEl.classList.add("value");valueEl.append(this.formatCurrencyValue(dataItem.value));itemLI.appendChild(valueEl);return itemLI;},getLegend:function(){var _this=this;var legendUl=document.createElement("ul");legendUl.classList.add("legend");this.data.forEach(function(el,i){return legendUl.appendChild(_this.getLegendItem(el,i));});return legendUl;},renderDescription:function(){var descriptionDiv=document.createElement("div");descriptionDiv.classList.add("description");descriptionDiv.appendChild(this.getSummary());descriptionDiv.appendChild(this.getLegend());this.elementRef.appendChild(descriptionDiv);},renderChart:function(){var chartDiv=document.createElement("div");chartDiv.classList.add("chart");new chartist_1["default"].Pie(chartDiv,{series:this.data.map(function(el){return el.value;})},{donut:true,donutWidth:60,donutSolid:true,startAngle:270,showLabel:false});this.elementRef.appendChild(chartDiv);},renderVis:function(){this.elementRef.innerHTML="";this.renderDescription();this.renderChart();},renderError:function(message){this.elementRef.classList.add("error");this.elementRef.innerHTML=message;},updateAsync:function(data,element,config,queryResponse,details,doneRendering){var currency=config.currency,sumLabel=config.sumLabel,queryFields=config.query_fields;var labelField=queryFields.dimensions[0].name;var valueField=queryFields.measures[0].name;this.data=data.map(function(el){return({label:el[labelField].value,value:el[valueField].value});});this.elementRef=element;this.currency=currency;this.sumLabel=sumLabel;this.queryFields=queryFields;if(queryFields.dimensions.length===1&&queryFields.measures.length===1&&queryFields.measures[0].is_numeric){this.renderVis();}
else{this.renderError("Please provide one dimension and one numeric measure");}
doneRendering();}};looker.plugins.visualizations.add(vis);